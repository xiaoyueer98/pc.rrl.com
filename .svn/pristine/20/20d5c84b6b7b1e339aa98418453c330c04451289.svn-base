<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>用户中心-人人猎</title>
        <meta name="keywords" content="人人猎,人人猎网，人人猎头,renrenlie.com,www.renrenlie.com,人人猎首页,人人猎官网，人人都是猎头" />
        <meta name="description" content="人人猎（www.renrenlie.com)是企业低成本极速直招平台，让企业一周内搞定招聘需求，为推荐人提供“人力资源”变现通道。" />
        <script type="text/javascript" src="__ROOT__/Public/js/jquery-1.11.0.min.js"></script>
        <script type="text/javascript" src="__ROOT__/Public/js/focuspic.js"></script>
        <script type="text/javascript" src="__ROOT__/Public/js/menu_v.js"></script>
        <script type="text/javascript" src="__ROOT__/Public/js/script.js"></script>
        <script type="text/javascript" src="__ROOT__/Public/js/jquery.form.js"></script> 
        <link rel="icon" href="__ROOT__/Public/img/favicon.ico" type="image/ico">
        <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/resizer.css">
        <link rel="stylesheet" href="__ROOT__/Public/css/focuspic.css" />
        <link rel="stylesheet" href="__ROOT__/Public/css/menu_v.css" />
        <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/style.css">
    </head>
    <body>
        <!-- 遮罩层 -->
        <div class="mask" id="mask"></div>

    <include file="Public:zzwc"/>
    <include file="Public:zhuce"/>
    <include file="Public:denglu"/>
    <include file="Public:recomLeftNav"/>
    <include file="Public:Right"/>
    <div class="center">
        <include file="Public:centerTop"/>
        <div class="PersData">
            <div class="cn cn1 Infor">
                <div class="cn_tp">
                    <h3>基本信息</h3>
                    <dl class="clearfix">
                        <dt>
                        <ul>
                            <php>
                                $username = $userinfo['username'];
                                if(strlen($username)=="31" && substr($username,0,3) == "wx_"){
                                $username = "微信用户";
                                }
                                if(substr($username,0,3) == "qq_"){
                                $username = $_COOKIE[$username];
                                }
                            </php>
                            <li><em>用户名 :</em><span >{$username}</span></li>
                            <li><em>真实姓名 :</em><span id="t2">{$userinfo['cnname']}</span></li>
                            <li><em>邮箱 :</em><span id="t3">{$userinfo['email']}</span></li>
                            <li><em>手机 :</em><span id="t4" class="mobileed">{$userinfo['mobile']}</span></li>
                            <li><p><em>性别 :</em>
                                    <span id="t5">
                                        <if condition="$userinfo.sex eq 1">
                                            女
                                            <else/>
                                            男
                                        </if>
                                    </span>
                                </p><p><em>年龄 :</em><span id="t6">{$userinfo['age']}</span></p></li>
                            <li><!--<p><em>QQ :</em><span id="t7">{$userinfo['qqnum']}</span> </p>-->
                                <p><em>微信 :</em><span  id="t8">{$userinfo['weixin']}</span></p></li>
                        </ul>
                        </dt>
                        <dd>

                            <img src="__ROOT__{$userinfo['avatar']}" alt=""  id="t9">
                        </dd>
                    </dl>
                </div>
                <div class="cn_btm">
                    <input class="btn cur_point" type="button" value="修改">
                </div>
            </div>
            <div class="cn cn1 Modify" style="display:none">
                <div class="cn_tp">
                    <h3>基本信息</h3>
                    <form enctype="multipart/form-data" action="__URL__/useradd" method="post" id="submitBaseInfo">

                        <dl class="clearfix">
                            <dt>
                            <ul>
                                <php>
                                    $username = $userinfo['username'];
                                    if(strlen($username)=="31" && substr($username,0,3) == "wx_"){
                                    $username = "微信用户";
                                    }
                                    if(substr($username,0,3) == "qq_"){
                                    $username = $_COOKIE[$username];
                                    }
                                </php>
                                <li><em>用户名 :</em><span>{$username}</span></li>
                                <li class="zzxm"><em>真实姓名 :</em><input style="width:183px" id="cnname" class="ip1 hanzi" type="text" placeholder="请输入真实姓名" name="cnname" value="{$userinfo['cnname']}"></li>
                                <li class="zzxm"><em>邮箱 :</em><span>{$userinfo['email']}</span></li>
                                <li class="zzxm"><em>手机 :</em><input class="ip1 shoujihao" name="mobile" type="text" placeholder="请输入手机号" value="{$userinfo['mobile']}" id="mobile" style="width:183px"><input class="butondx cur_point"  type="button" value="验证手机号码"></li>
                                <li>
                                    <p class="clearfix">
                                        <em class="xb">性别 :</em>
                                        <input class="ip2" id="sex" name="sex" type="radio" value="0" <?php if($userinfo['sex'] == "0") echo 'checked=checked';?>>
                                               <label for="nan">男</label>
                                        <input class="ip2" id="sex" name="sex" type="radio" value="1" <?php if($userinfo['sex'] == "1") echo 'checked=checked';?>><label for="nv">女</label>
                                    </p>
                                    <p>
                                        <em class="xb">年龄 :</em>
                                        <input type="text" class="ip3" name="age" id="age" placeholder="年龄" value="{$userinfo['age']}">
                                    </p>
                                </li>
                                <li><!--<p><em>QQ :</em><input type="text" name="qqnum" id="qqnum" class="qq" placeholder="请输入QQ" value="{$userinfo['qqnum']}"></p>--><p><em>微信 :</em><input type="text" id="weixin" class="weixin" placeholder="请输入微信号" name="weixin"  value="{$userinfo['weixin']}"></p></li>
                                <li><p class="error2" style="display:none;margin-left:75px;color:#de6a6a;">第三方第三方</p></li>
                            </ul>
                            </dt>
                            <dd>
                                <div id="preview"  style="height:100%;width: 100%;padding: 0px;display: none">   
                                    <img id="imghead"  width=100% height=100% border=0 >   
                                </div>   
                                <input type="file" class="EntLogo cur_point"  name="avatar" onchange="previewImage(this)" />     

                                <img src="/Public/img/HeadPort.png" alt="">
                            </dd>
                        </dl>
                </div>
                <div class="cn_btm">
                    <input class="btn2" type="hidden" value="" id="check_coded" name="check_coded">
                    <input class="btn1 cur_point" type="button" value="保存" name="baocun" onclick="ajaxadd()">
                    <input class="btn2 cur_point" type="button" value="取消">
                </div>
                </form>
            </div>
        </div>
        <include file="Public:centerFooter"/>
    </div>
    <include file="Public:fiexdTop"/>
    <div id="regtelephone" class="denglu yzsj" style="display:none">
        <a class="Close"></a>
        <h4>验证手机</h4>
        <ul class="jcid">
            <li><div id="telephoneCheck">您的手机号码是：</div></li>
            <li  style="text-align: center;">
                <button class='btn cur_point' id="getcheckCode" style="background: none repeat scroll 0 0 #2380b8;border: medium none;border-radius: 5px;color: #ffffff;font-size: 14px;font-weight: bold; height: 30px;width: 174px;text-align: center;">获取短信验证码</button><label class="vfit_btn2"  style="display: none" id="codetimes"><i>60</i>秒后重新获取</label>

            </li>
            <li><div><em>验证码：</em><input class="inpu1" type="text" id="code"><i class="error3" style="display:none;">不能为空</i></div></li>
            <li><div><input type="button" class="butonqr cur_point" value="确认" id="checkbtn"></div></li>
        </ul>
        <input type="hidden" id="isFinshed">
    </div>
</body>
<script type="text/javascript">
    /*------------------个人信息验证手机号------------------*/
    $('.butondx').on('click', function() {
        var telephoneCheck = $("#mobile").val();
        $("#telephoneCheck").html("您的手机号码是：" + telephoneCheck);
        $('.yzsj').show();
        $('.mask').show();
    })

    //图片上传预览    IE是用了滤镜。   
    function previewImage(file)
    {
        var MAXWIDTH = "100%";
        var MAXHEIGHT = "100%";
        var div = document.getElementById('preview');
        if (file.files && file.files[0])
        {
            div.innerHTML = '<img id=imghead>';
            var img = document.getElementById('imghead');
            img.onload = function() {
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
                img.width = rect.width;
                img.height = rect.height;
                //                 img.style.marginLeft = rect.left+'px';   
                img.style.marginTop = rect.top + 'px';
            }
            var reader = new FileReader();
            reader.onload = function(evt) {
                img.src = evt.target.result;
            }

            reader.readAsDataURL(file.files[0]);
        }
        else //兼容IE   
        {
            var sFilter = 'filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
            file.select();
            var src = document.selection.createRange().text;
            div.innerHTML = '<img id=imghead>';
            var img = document.getElementById('imghead');
            img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            status = ('rect:' + rect.top + ',' + rect.left + ',' + rect.width + ',' + rect.height);
            div.innerHTML = "<div id=divhead style='width:" + rect.width + "px;height:" + rect.height + "px;margin-top:" + rect.top + "px;" + sFilter + src + "\"'></div>";
        }
        $("#preview").show();
    }
    function clacImgZoomParam(maxWidth, maxHeight, width, height) {
        var param = {top: 0, left: 0, width: width, height: height};
        if (width > maxWidth || height > maxHeight)
        {
            rateWidth = width / maxWidth;
            rateHeight = height / maxHeight;

            if (rateWidth > rateHeight)
            {
                param.width = maxWidth;
                param.height = Math.round(height / rateWidth);
            } else
            {
                param.width = Math.round(width / rateHeight);
                param.height = maxHeight;
            }
        }

        param.left = Math.round((maxWidth - param.width) / 2);
        param.top = Math.round((maxHeight - param.height) / 2);
        return param;
    }
</script>
<script type="text/javascript">

    $(function() {
        $("#check_coded").val("");
        $("#code").val("");
        $("#error2").hide();
        $("#getCode").attr("disabled", false);
        $("#getcheckCode").click(function() {
            var mobile = $("#mobile").val();
            $("#getcheckCode").attr("disabled", "disabled");
            $.post("__URL__/getCode", {"telephoneCheck": mobile}, function(data) {
                if (data.code != "500") {
                    time($("#getcheckCode"), $("#codetimes"));
                } else {
                    $(".error3").html(data.msg);
                    $(".error3").show();
                }
            }, "json")
        })
        var wait = 60;
        function time(o, t) {
            if (wait == 0) {

                o.attr("disabled", false);
                t.hide();
                o.show();
                wait = 60;
            } else {
                t.find("i").html(wait);
                o.hide();
                t.show();
                wait--;
                setTimeout(function() {
                    time(o, t)
                },
                        1000)
            }
        }

        $(".butonqr").click(function() {
            var code = $("#code").val();
            if (code) {
                if (/^[0-9]{4}$/.test(code)) {
                    $('.error3').hide();
                } else {
                    $('.error3').html('验证码格式不正确')
                    $('.error3').show();
                }
            } else {
                $('.error3').html('验证码不能为空')
                $('.error3').show();
            }
            $.ajax({
                type: "post",
                dataType: "json",
                data: {"code": code},
                url: "__URL__/checkCode",
                success: function(data) {

                    if (data.code != "200") {
                        $(".error3").html(data.msg);
                        $(".error3").show();
                    } else {
                        $("#check_coded").val(data.msg);
                        $('.yzsj').hide();
                        $('.mask').hide();
                        $(".error3").hide();
                    }
                }
            });
        });
    })


    function ajaxadd() {
        var cnname = $("#cnname").val();
        var code = $("#check_coded").val();
        var mobileed = $(".mobileed").html();
        var mobile = $("#mobile").val();
        var age = $("#age").val()
        if (!cnname) {
            $("#cnname").focus();
            $('.error2').html('请输入您的真实姓名');
            $('.error2').show();
            return false;
        }
        if (!mobile) {
            $('.error2').html('请输入手机号码');
            $('.error2').show();
            return false;
        }
        if (!age || parseInt(age) == 0) {
            $('.error2').html('请正确输入年龄');
            $('.error2').show();
            return false;
        }
        var reg = /^1[3|4|5|8][0-9]\d{4,8}$/;
        /*
        if (!reg.test(mobile) || mobile.length != 11) {
            $("#mobile").focus();
            $('.error2').html('请正确输入手机号码');
            $('.error2').show();
            return false;
        }
        */
        if (mobileed == mobile) {

            $("#submitBaseInfo").ajaxSubmit({
                type: 'post',
                dataType: "json",
                url: "__URL__/useradd",
                success: function(data) {

                    return false;
                },
                error: function(XmlHttpRequest, textStatus, errorThrown) {

                    $.post("__URL__/getUserInfo", {}, function(data) {
                        $("#t2").html(data.cnname);
                        $("#t3").html(data.email);
                        $("#t4").html(data.mobile);
                        if (data.sex > 0) {
                            $("#t5").html("女");
                        } else {
                            $("#t5").html("男");
                        }
                        $("#t6").html(data.age);
                        $("#t7").html(data.qqnum);
                        $("#t8").html(data.weixin);
                        $('#t9').attr("src", data.avatar);
                        $('.Modify').hide();
                        $('.Infor').show();
                        $('.Self').show();
                    }, "json")
                }
            });
        } else {
            if (!code) {
                $("#mobile").focus();
                $('.error2').html('请验证您的手机号码！');
                $('.error2').show();
                return false;
            }
            $.post("__URL__/checkCode", {code: code}, function(data) {
                if (data.code != "200") {
                    $('.error2').html('手机验证码不正确或未验证请重新获取');
                    $('.error2').show();
                    return false;
                } else {
                    $("#submitBaseInfo").ajaxSubmit({
                        type: 'post',
                        dataType: "json",
                        url: "__URL__/useradd",
                        success: function(data) {

                            return false;
                        },
                        error: function(XmlHttpRequest, textStatus, errorThrown) {

                            $.post("__URL__/getUserInfo", {}, function(data) {
                                $("#t2").html(data.cnname);
                                $("#t3").html(data.email);
                                $("#t4").html(data.mobile);
                                if (data.sex > 0) {
                                    $("#t5").html("女");
                                } else {
                                    $("#t5").html("男");
                                }
                                $("#t6").html(data.age);
                                $("#t7").html(data.qqnum);
                                $("#t8").html(data.weixin);
                                $('#t9').attr("src", data.avatar);
                                $('.Modify').hide();
                                $('.Infor').show();
                                $('.Self').show();
                            }, "json")
                        }
                    });
                }
            }, "json");
        }

        return false;
    }
</script>
</html>